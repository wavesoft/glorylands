/* GloryLands API Javascript API - Compressed with YUI compressor */ 
/* (C) Copyright 2007-09 John Haralampidis. Licenced under the GNU/GPL Licence */ 
 
var isInternetExplorer=(navigator.userAgent.indexOf("MSIE")>=0);var isMozilla=(navigator.userAgent.indexOf("Gecko")>=0);var isOpera=(navigator.userAgent.indexOf("Opera")>=0);function $trace(a){ans="";$each(a,function(c,b){if(ans!=""){ans+=", "}ans+="["+b+"] = "+c});return ans}var CBChain=new Class({initialize:function(){this.chain=[]},register:function(b,a){if(!$defined(this.chain[b])){this.chain[b]=[]}this.chain[b].push(a)},call:function(h,g,f,c,b,a){if($defined(this.chain[h])){try{this.chain[h].each(function(i){i(g,f,c,b,a)})}catch(d){}}}});var callback=new CBChain();function getScrollPosition(){var b=0;var c=0;if(typeof(window.pageYOffset)=="number"){b=window.pageXOffset;c=window.pageYOffset}else{if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){b=document.documentElement.scrollLeft;c=document.documentElement.scrollTop}else{if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){b=document.body.scrollLeft;c=document.body.scrollTop}}}var a={x:b,y:c};return a}var waiterShown=false;var waiterFX=false;var waiterDisposer=0;function initWaiter(){waiterFX=new Fx.Styles("waiter",{duration:400,transition:Fx.Transitions.Back.easeIn,onComplete:function(){if(!waiterShown){$("waiter_host").setStyles({display:"none"})}}});$("waiter_host").setStyles({display:"none"})}function showStatus(c,a){try{if(waiterDisposer>0){clearTimeout(waiterDisposer);waiterDisposer=0}if(!c){if(waiterShown){waiterShown=false;waiterFX.stop();waiterFX.start({opacity:0})}}else{$("waiter").setHTML(c);if(!waiterShown){$("waiter_host").setStyles({display:""});$("waiter_host").setStyles({"z-index":lastZ});waiterShown=true;waiterFX.stop();waiterFX.start({opacity:1})}if(a){waiterDisposer=setTimeout(function(){showStatus()},a)}}}catch(b){}}var winCache=[];var lastZ=250002;function createWindow(f,i,o,l,p,g,k){if(!winCache[f]){var a=document.createElement("div");var e=document.createElement("div");var c=document.createElement("span");var n=document.createElement("a");var m=document.createElement("a");if(!isInternetExplorer){a.setAttribute("class","container");e.setAttribute("class","dragger");c.setAttribute("class","content");n.setAttribute("class","toggle");m.setAttribute("class","dispose")}else{a.setAttribute("className","container");e.setAttribute("className","dragger");c.setAttribute("className","content");n.setAttribute("className","toggle");m.setAttribute("className","dispose")}n.setAttribute("title","Minimize");m.setAttribute("title","Close");e.innerHTML='<span align="top" class="left">&nbsp;</span><span class="center">'+f+'</span><span class="right">&nbsp;</span>';a.appendChild(e);a.appendChild(c);c.innerHTML=i;if(!isMozilla){var b=new Fx.Slide(c)}n.setAttribute("href","javascript:;");n.innerHTML="&nbsp;";e.appendChild(n);$(n).addEvent("click",function(d){d=new Event(d);if(!isMozilla){b.toggle()}else{if(c.style.display=="none"){c.style.display=""}else{c.style.display="none"}}d.stop()});m.setAttribute("href","javascript:void(null)");m.innerHTML="&nbsp;";e.appendChild(m);$(m).addEvent("click",function(d){d=new Event(d);gloryIO("?a=window.closed&guid="+k,false,true);a.remove();winCache[f]=false;d.stop()});$(e).addEvent("mousedown",function(d){a.setStyles({opacity:0.7,"z-index":lastZ++})});$(e).addEvent("mouseup",function(d){a.setStyles({opacity:1})});$(a).addEvent("mousedown",function(d){a.setStyles({"z-index":lastZ++})});if(o){a.setStyles({left:o})}if(l){a.setStyles({top:l})}if(p){a.setStyles({width:p})}if(g){a.setStyles({height:g})}a.setStyles({"z-index":lastZ++});document.body.appendChild(a);var j=new Drag.Move(a,{handle:e});winCache[f]=[a,c,b];return a}else{var a=winCache[f][0];var c=winCache[f][1];var b=winCache[f][2];if(!isMozilla){b.slideIn()}else{c.style.display=""}c.innerHTML=i;if(p){a.setStyles({width:p})}if(g){a.setStyles({height:g})}}}var data_cache=[];var ex_buffer_data="";function initDisplayBuffer(){ex_buffer_data=$("databuffer").innerHTML}function clearDisplayBuffer(){$("databuffer").setHTML("")}function displayBuffer(b,a,d,c){map_reset();wgrid_dispose();$("databuffer").setStyle("visibility","visible");$("datapane").setStyle("visibility","hidden");$("datahost").setStyles({"background-image":""});var e=b;if(c!=""){if(a!=""){if(d!=""){e+='<span class="maplabel"><a class="navlink" href="javascript:gloryIO(\''+a+'\',false,true);"><img align="absmiddle" src="images/'+d+'" /></a> '+c+"</span>"}else{e+='<span class="maplabel"><a class="navlink" href="javascript:gloryIO(\''+a+"',false,true);\"> "+c+"</a></span>"}}else{if(d!=""){e+='<span class="maplabel"><img align="absmiddle" src="images/'+d+'" /> '+c+"</span>"}else{e+='<span class="maplabel"> '+c+"</span>"}}}e+=ex_buffer_data;$("databuffer").setHTML(e)}var ddw_visible=false;function ddwin_change(b){var a=ddwin_prepare();a.chain=function(){gloryIO(b,false,true)}}function ddwin_dispose(){if(ddw_visible){var a=new Fx.Styles("dd_popup",{duration:500,transition:Fx.Transitions.Cubic.easeOut});var d=new Fx.Styles("dd_content",{duration:500,transition:Fx.Transitions.Cubic.easeOut});var b=$("dd_popup");var c=$("dd_host");var e=$("dd_content");d.start({opacity:0}).chain(function(){e.setHTML("");a.start({opacity:0,width:10,height:10}).chain(function(){c.setStyles({display:"none"})})});ddw_visible=false}}function ddwin_show(d,a,h){var c=$("dd_popup");var g=$("dd_content");var f=$("dd_host");var b=new Fx.Styles("dd_popup",{duration:500,transition:Fx.Transitions.Cubic.easeOut});var e=new Fx.Styles("dd_content",{duration:500,transition:Fx.Transitions.Cubic.easeOut});if(ddw_visible){e.start({opacity:0}).chain(function(){b.start({height:a,width:d,opacity:1}).chain(function(){g.setHTML('<div style="position:relative; width:100%; height:100%"><span class="dd_head"><a href="javascript:ddwin_dispose()">X</a></span>'+h+"</div>");e.start({opacity:1})})})}else{f.setStyles({display:"","z-index":lastZ++});c.setStyles({opacity:0,width:10,height:10});g.setStyles({opacity:0,display:"none"});g.setHTML('<div style="position:relative; width:100%; height:100%"><span class="dd_head"><a href="javascript:ddwin_dispose()">X</a></span>'+h+"</div>");b.start({opacity:1,width:d,height:a}).chain(function(){g.setStyles({display:""});e.start({opacity:1})});ddw_visible=true}}function ddwin_prepare(){var c=$("dd_popup");var f=$("dd_content");var e=$("dd_host");var a=new Fx.Styles("dd_popup",{duration:500,transition:Fx.Transitions.Cubic.easeOut});var d=new Fx.Styles("dd_content",{duration:500,transition:Fx.Transitions.Cubic.easeOut});var b={chain:null};if(!ddw_visible){e.setStyles({display:"","z-index":lastZ++});c.setStyles({opacity:0});f.setStyles({opacity:1});f.setHTML('Please&nbsp; <img src="images/UI/loading2.gif" align="absmiddle" /> &nbsp;wait...');ddw_visible=true;b=a.start({opacity:1,width:120,height:20}).chain(b.chain)}else{d.start({opacity:0}).chain(function(){f.setHTML('Please&nbsp; <img src="images/UI/loading2.gif" align="absmiddle" /> &nbsp;wait...');d.start({opacity:1});b=a.start({width:120,height:20}).chain(b.chain)})}return b}var msgstack=[];var msglocked=false;function lockMessages(a){msglocked=a;if(!a){$each(msgstack,function(b,c){handleMessages(b)});msgstack=[]}}function handleMessages(c){if(msglocked){msgstack.push(c);return}var g="",m="";for(var f=0;f<c.count;f++){if($defined(c.message[f])){g=c.message[f][0];m=c.message[f][1];if(g=="MSGBOX"){window.alert(m)}else{if(g=="POPUP"){var b=310;if($defined(c.message[f][3])){b=c.message[f][3]}var d=(screen.width-b)/2;var l=120;var k=false;if($defined(c.message[f][4])){if(c.message[f][4]!=false){d=c.message[f][4]}}if($defined(c.message[f][5])){if(c.message[f][5]!=false){l=c.message[f][5]}}if($defined(c.message[f][6])){if(c.message[f][6]!=false){k=c.message[f][6]}}createWindow(c.message[f][2],c.message[f][1],d,l,b,false,k)}else{if(g=="CALL"){var j=true;if($defined(c.message[f][2])){j=c.message[f][2]}gloryIO(m,false,j)}else{if(g=="NAVIGATE"){window.location="index.php?a="+m}else{if(g=="UPDATEGRID"){gloryIO("?a=map.grid.get&quick=1",false,true)}else{if(g=="RECT"){var a=$("grid_rect");try{if($defined(a)){if(m){rectinfo.w=1;rectinfo.h=1;rectinfo.bx=0;rectinfo.by=0;rectinfo.url="";rectinfo.clickdispose=true;rectinfo.silent=false;if($defined(c.message[f][2])){rectinfo.url=c.message[f][2]}if($defined(c.message[f][3])){rectinfo.w=c.message[f][3]}if($defined(c.message[f][4])){rectinfo.h=c.message[f][4]}if($defined(c.message[f][5])){rectinfo.bx=c.message[f][5]}if($defined(c.message[f][6])){rectinfo.by=c.message[f][6]}if($defined(c.message[f][7])){rectinfo.clickdispose=c.message[f][7]}if($defined(c.message[f][8])){rectinfo.silent=c.message[f][8]}a.setStyles({display:""})}else{a.setStyles({display:"none"})}}}catch(h){window.alert("RECT Error"+h)}}else{if(g=="ALTER"){}else{if(g=="ACTIONGRID"){if($defined(c.message[f][1])){wgrid_design(c.message[f][1],true);wgrid_show()}}else{if(g=="POLLINTERVAL"){feeder_interval=c.message[f][1]}else{callback.call("message",c.message[f])}}}}}}}}}}}}var data_io_time=0;function gloryIO(b,f,a,d){try{reset_feeder();if(!a){showStatus('Loading...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/UI/mouseloading.gif" />')}data_io_time=$time();var c=new Json.Remote(b,{headers:{"X-StreamID":"41293"},onComplete:function(m){showStatus();data_io_time=$time()-data_io_time;var n="NONE";if($defined(m.mode)){n=m.mode}if(n=="POPUP"){var j=100;var t=20;var i=310;var x=false;var s=false;if($defined(m.left)){j=m.left}if($defined(m.top)){t=m.top}if($defined(m.width)){i=m.width}if($defined(m.height)){i=m.height}if($defined(m.guid)){s=m.guid}createWindow(m.title,m.text,j,t,i,x,s)}else{if(n=="MAIN"){var o="";var r="";var u="";if($defined(m.head_link)){o=m.head_link}if($defined(m.head_image)){r=m.head_image}if($defined(m.title)){u=m.title}nav_grid=[];overlay_grid=[];resetRegion();piemenu_dispose();disposeActionPane();map_curtain(true).chain(function(){displayBuffer(m.text,o,r,u);map_curtain(false)})}else{if(n=="INFO"){}else{if(n=="FULL"){}else{if(n=="BLANK"){}else{if(n=="NONE"){}else{if(n=="GRID"){resetRegion();var v=false;var o="";var r="";var u="";var h="none.gif";if($defined(m.rollback)){v=m.rollback}if($defined(m.head_link)){o=m.head_link}if($defined(m.head_image)){r=m.head_image}if($defined(m.title)){u=m.title}if($defined(m.background)){h=m.background}grid_display.rollback=v;grid_display.head_link=o;grid_display.head_image=r;grid_display.background=h;grid_display.title=u;if($defined(m.x)){grid_x=m.x}if($defined(m.y)){grid_y=m.y}if($defined(m.map)){if(map_current!=m.map){map_curtain(true);map_reset();map_loadbase(m.map)}}if($defined(m.objects)){$each(m.objects,function(z,e){if($defined(z.image)){var y=new String(z.image);if(y.indexOf(".php")>0){}else{m.objects[e].image="images/"+z.image}}});map_preloaded_update(m.objects)}}else{if(n=="DEDICATED"){var x=210;var i=400;if($defined(m.height)){x=m.height}if($defined(m.width)){i=m.width}try{ddwin_show(i,x,m.text)}catch(q){window.alert("DDWin Show Error: "+q)}}else{if(n=="DROPDOWN"){var l=[];var w=[];if($defined(m.menus)){l=m.menus}if($defined(m.text)){w=m.text}if(pie_wait_icon){piemenu_show(l,w)}}else{if(n=="ERROR"){if(!a){showStatus('<font color="red">'+m.error+"</font>",5000)}}else{callback.call("ioreply",m)}}}}}}}}}}if($defined(m.messages)){handleMessages(m.messages)}try{var p=/a=(.*)&/i;var k=p.exec(b+"&");if(!$chk(k)){callback.call("iocomplete",false,m)}else{callback.call("iocomplete",k[1],m)}}catch(q){window.alert("RegEx Error: "+q)}if(d){d(m)}},onFailure:function(e){window.alert("JSON Error: "+$trace(e));if(!a){showStatus('<font color="red">Connection failure!</font>',1000)}if(d){d(false)}}}).send(f)}catch(g){window.alert("GloryIO Error: "+obj.message);if(!a){showStatus('<font color="red">Data Error!</font>',1000)}}}var data_grid=false;var collision_grid=false;var data_dictionary=false;var grid_range=false;var overlay_grid=false;var nav_grid=false;var current_map="";var glob_x_base=0;var glob_y_base=0;var grid_x=0,grid_y=0;var grid_display={rollback:false,head_link:false,head_image:false,title:false,background:"none.gif"};var rectinfo={w:3,h:3,bx:1,by:2,url:"",clickdispose:false,silent:false};var map_dynamic_objects=[];var map_objects=[];var map_object_index=[];var map_info=[];var map_back=[];var map_curtain_status=false;var map_curtain_fx=null;var map_scroll_pos={x:0,y:0};var map_last_id=0;var map_viewpoint={x:0,y:0};var map_center_fx=null;var map_current="";var map_playeruid=0;function map_center(a,c,b){if(!a){a=map_viewpoint.x}if(!c){a=map_viewpoint.y}if(map_center_fx){map_center_fx.stop()}map=new Fx.Styles($("datapane"),{duration:400,unit:"px",transition:Fx.Transitions.Expo.easeInOut});map.start({left:-a+384,top:-c+256});map_center_fx=map;if(b){map_viewpoint={x:a,y:c}}}function map_scroll(a,b){if(!$defined(a)){a=map_scroll_pos.x}if(!$defined(b)){b=map_scroll_pos.y}$("datapane").setStyles({left:a,top:b});return;$each(map_objects,function(d,c){d.object.setStyles({left:d.x-a,top:d.y-b})});$each(map_back,function(d,c){d.object.setStyles({left:d.x-a,top:d.y-b})});map_scroll_pos={x:a,y:b}}function map_curtain(a){if(map_curtain_fx){map_curtain_fx.stop()}map_curtain_fx=new Fx.Styles($("dataloader"),{duration:400,unit:"px",transition:Fx.Transitions.Expo.easeInOut});if(a&&!map_curtain_status){showStatus();map_curtain_status=true;map_curtain_fx.element.setStyles({visibility:""});return map_curtain_fx.start({opacity:1,height:512})}else{if(!a&&map_curtain_status){map_curtain_status=false;return map_curtain_fx.start({opacity:0,height:1}).chain(function(){this.element.setStyles({visibility:"hidden"})})}}}function map_reset(){$each(map_objects,function(b,a){b.object.remove()});$each(map_back,function(b,a){b.object.remove()});map_current="";map_center_fx=null;map_scroll_pos={x:0,y:0};map_dynamic_objects=[];map_objects=[];map_info=[];map_back=[];map_object_index=[];map_last_id=0;map_viewpoint={x:0,y:0}}function map_loadbase(b){clearDisplayBuffer();$("databuffer").setStyle("visibility","hidden");$("datapane").setStyle("visibility","visible");showStatus("Loading Map...");map_current=b;var a=new Json.Remote("data/maps/"+b+".map",{onComplete:function(c){map_info=c;map_preload()},onFailure:function(c){map_info={name:b,error:c.message}}}).send()}function map_preload(){showStatus("Loading Graphics...");var d=null;var c=false;var b=map_info.images;$each(b,function(h,f){var g=new String(h);if(g.indexOf(".php")>0){}else{b[f]="images/elements/"+h}});for(var a=0;a<map_info.background.xsize;a++){for(var e=0;e<map_info.background.ysize;e++){b.push("data/maps/"+map_info.background.name+"-"+a+"-"+e+".png")}}b.push("images/tiles/"+map_info.background);new Asset.images(b,{onComplete:function(){c=true;if(d){clearTimeout(d);d=null}map_finalize()},onProgress:function(g){if(!c){var f=Math.ceil(100*g/b.length);if(f>100){f-=100}showStatus("Loading Graphics ["+f+" %]");if(d){clearTimeout(d);d=null}d=setTimeout(map_finalize,2000)}}})}function map_finalize(){$("datahost").setStyles({"background-image":"url(images/tiles/"+map_info.background.fill+")"});var b=0;for(var a=0;a<map_info.background.xsize;a++){for(var e=0;e<map_info.background.ysize;e++){var c="data/maps/"+map_info.background.name+"-"+a+"-"+e+".png";var d=$(document.createElement("img"));d.setProperty("src",c);$("datapane").appendChild(d);d.setStyles({left:(a*map_info.background.width),top:(e*map_info.background.height),position:"absolute",width:map_info.background.width,height:map_info.background.height});map_back.push({object:d,x:(a*map_info.background.width),y:(e*map_info.background.height)})}}showStatus("Rendering Map...");$each(map_info.objects,function(f){f.image=map_info.images[f.image];map_addobject(f)});map_curtain(false);showStatus()}function map_objecttrigger(g,d,i){try{var b=getScrollPosition();var a=map_object_index.indexOf(g);if(d=="contextmenu"){piemenu_dispose();if($defined(map_objects[a].info.guid)){piemenu_init(i.client.x+b.x,i.client.y+b.y,map_objects[a].info.guid,"MAP")}}else{if(d=="mousemove"){if($defined(map_objects[a].info.name)){var j=map_objects[a].info.name;if($defined(map_objects[a].info.subname)){j+='<br /><font color="#33FF33" size="1"><em>'+map_objects[a].info.subname+"</em></font>"}hoverShow(j,i.client.x+b.x,i.client.y+b.y);if($defined(map_objects[a].info.range)){var k=map_objects[a].object.getPosition();var c=map_objects[a].object.getSize().size;var f=k.y+(c.y/2);if(i.client.y+b.y>f){if(!wgrid_visible){wgrid_design(map_objects[a].info.range);wgrid_show()}}}}}else{if(d=="click"){if($defined(map_objects[a].info.range)){if(!wgrid_visible){wgrid_design(map_objects[a].info.range);wgrid_show()}}else{if($defined(map_objects[a].info.click)){gloryIO(map_objects[a].info.click,false,false)}}}else{if(d=="mouseout"){hoverShow(false);if(!wgrid_hard_dispose){wgrid_hide()}}}}}}catch(i){window.alert("Object Trigger Error: "+i)}}var map_preloaded_stack=[];function map_preloaded_update(d){var a=[];var c=null;var b=false;$each(d,function(g,f){if(map_preloaded_stack.indexOf(g.image)<0){a.push(g.image);map_preloaded_stack.push(g.image)}});if(a.length>0){showStatus("Loading new objects...");new Asset.images(a,{onComplete:function(){showStatus();map_updatedata(d)}})}else{map_updatedata(d)}}function map_updatedata(c){if(map_dynamic_objects.length==0){map_dynamic_objects=c;$each(c,function(j,i){map_dynamic_objects[i].index=map_addobject(j)})}else{var g=[];var f=[];var b=[];for(var d=0;d<map_dynamic_objects.length;d++){var l=false;var h=false;for(var a=c.length-1;a>=0;a--){if($defined(c[a].id)&&$defined(map_dynamic_objects[d].id)){if(c[a].id==map_dynamic_objects[d].id){l=true;g.push(a);h=c[a];break}}else{if((c[a].x==map_dynamic_objects[d].x)&&(c[a].y==map_dynamic_objects[d].y)&&(c[a].image==map_dynamic_objects[d].image)){l=true;g.push(a);break}}}if(!l){f.push(map_dynamic_objects[d].index)}else{if(h!=false){b.push({index:map_dynamic_objects[d].index,cdata:h})}}}for(var d=f.length-1;d>=0;d--){map_removeobject(f[d])}map_dynamic_objects=[];for(var d=0;d<b.length;d++){b[d].cdata.index=b[d].index;map_dynamic_objects.push(b[d].cdata);map_updateobject(b[d].index,b[d].cdata)}for(var d=0;d<c.length;d++){if(g.indexOf(d)<0){var k=c[d];var e=map_addobject(k);k.index=e;map_dynamic_objects.push(k)}}}}function map_addobject(b){if(!$defined(b.cx)){b.cx=0}if(!$defined(b.cy)){b.cy=0}callback.call("object_put",b);var f=$(document.createElement("img"));f.src=b.image;$("datapane").appendChild(f);var i=f.getSize().size;var g=b.x*32-b.cx;var e=b.y*32-b.cy-i.y;var h=b.y*500+g;if(h<0){h=1}f.setStyles({position:"absolute",left:g,top:e,"z-index":h});var c=map_last_id++;var a=map_objects.length;map_object_index[a]=c;map_objects[a]={info:b,x:g,y:e,width:i.x,height:i.y,cx:b.cx,cy:b.cy,object:f};if($defined(b.player)){map_playeruid=c}if(b.dynamic){f.addEvent("contextmenu",function(j){var j=new Event(j);map_objecttrigger(c,"contextmenu",j);j.stop()});f.addEvent("mousemove",function(j){var j=new Event(j);f.setStyles({opacity:0.7});map_objecttrigger(c,"mousemove",j);j.stop()});f.addEvent("mouseout",function(j){var j=new Event(j);f.setStyles({opacity:1});map_objecttrigger(c,"mouseout",j);j.stop()});f.addEvent("mousedown",function(j){var j=new Event(j);map_objecttrigger(c,"mousedown",j);j.stop()});f.addEvent("mouseup",function(j){var j=new Event(j);map_objecttrigger(c,"mouseup",j);j.stop()});f.addEvent("click",function(j){var j=new Event(j);map_objecttrigger(c,"click",j);j.stop()});if($defined(b.fx_show)){switch(b.fx_show){case"fade":var d=new Fx.Styles(f,{wait:false,duration:400,transition:Fx.Transitions.Quad.easeIn});f.setStyles({opacity:0});d.start({opacity:1});break;case"pop":var d=new Fx.Styles(f,{wait:false,duration:400,transition:Fx.Transitions.Back.easeOut});f.setStyles({opacity:0,top:e+32});d.start({opacity:1,top:e});break;case"drop":var d=new Fx.Styles(f,{wait:false,duration:400,transition:Fx.Transitions.Bounce.easeOut});f.setStyles({opacity:0,top:e-200});d.start({opacity:1,top:e});break;case"zoom":var d=new Fx.Styles(f,{wait:false,duration:400,transition:Fx.Transitions.Quad.easeIn});f.setStyles({opacity:0,width:5,height:5,left:(g+(i.x/2)),top:(e+(i.y/2))});d.start({opacity:1,width:i.x,height:i.y,left:g,top:e});break}}if($defined(b.focus)){map_center(g+Math.ceil(i.x/2),e+Math.ceil(i.y/2),true)}}return c}function map_removeobject(d,a){var f=map_object_index.indexOf(d);var e=map_objects[f];if(!e){return}callback.call("object_remove",e.info);var c=function(){e.object.remove();map_objects.splice(f,1);map_object_index.splice(f,1)};if(e.info.fx_hide&&!a){switch(e.info.fx_hide){case"fade":var b=new Fx.Styles(e.object,{wait:false,duration:400,transition:Fx.Transitions.Quad.easeOut});b.start({opacity:0}).chain(c);break;case"pop":var b=new Fx.Styles(e.object,{wait:false,duration:400,transition:Fx.Transitions.Back.easeIn});b.start({opacity:0,top:e.y+32}).chain(c);break;case"drop":var b=new Fx.Styles(e.object,{wait:false,duration:400,transition:Fx.Transitions.Back.easeIn});b.start({opacity:0,top:e.y-200});break;case"zoom":var b=new Fx.Styles(e.object,{wait:false,duration:400,transition:Fx.Transitions.Quad.easeIn});b.start({opacity:0,width:5,height:5,left:(e.x+(e.width/2)),top:(e.y+(e.height/2))});break;default:c()}}else{c()}}function map_fx_pathmove(a,c){var b=0;var e=new Fx.Styles(a,{duration:200,unit:"px",transition:Fx.Transitions.linear});var d=function(){if(!$defined(c[b])){return}var f=b;b++;var h=a.getSize().size;var g=(c[f].y+Math.round(h.y/32))*500+c[f].x;if(g<0){g=1}a.setStyle("z-index",g);e.start({left:c[f].x*32,top:c[f].y*32-h.y+32}).chain(d)};d()}function map_updateobject(d,b){var a=map_object_index.indexOf(d);var f=map_objects[a];if(!f){return}callback.call("object_update",{old:f,"new":b});if(!$defined(b.cx)){b.cx=f.cx}if(!$defined(b.cy)){b.cy=f.cy}if(!$defined(b.x)){b.x=f.info.x}if(!$defined(b.y)){b.y=f.info.y}f.object.src=b.image;var k=f.object.getSize().size;var h=b.x*32-b.cx;var g=b.y*32-b.cy-k.y;var j=b.y*500+h;if(j<0){j=1}f.x=h;f.y=g;f.width=k.x;f.height=k.y;f.info=b;if($defined(b.player)){map_playeruid=d}if(b.fx_move){switch(b.fx_move){case"slide":var c=new Fx.Styles(f.object,{duration:800,unit:"px",transition:Fx.Transitions.linear});var i=new Fx.Styles(f.object,{duration:800,unit:"",transition:Fx.Transitions.linear});i.start({"z-index":j});c.start({top:g}).chain(function(){c.start({left:h})});break;case"bounce":var c=new Fx.Styles(f.object,{duration:800,unit:"px",transition:Fx.Transitions.Elastic.easeOut});c.start({left:h,top:g});f.object.setStyles({"z-index":j});break;case"fade":var e=new Fx.Styles(f.object,{wait:false,duration:400,transition:Fx.Transitions.Quad.easeOut});e.start({opacity:0}).chain(function(){f.object.setStyles({left:h,top:g,"z-index":j});e.start({opacity:1})});break;case"path":if($defined(b.fx_path)){map_fx_pathmove(f.object,b.fx_path);delete b.fx_path;break}default:f.object.setStyles({left:h,top:g,"z-index":j})}}else{f.object.setStyles({left:h,top:g,"z-index":j})}if($defined(b.focus)){map_center(h+Math.ceil(f.width/2),g+Math.ceil(f.height/2),true)}}var wgrid_elements=[];var wgrid_host=null;var wgrid_pos={x:0,y:0};var wgrid_last_design_pos={x:0,y:0};var wgrid_visible=false;var wgrid_dispose_timer=null;var wgrid_hard_dispose=false;function wgrid_show(){if(wgrid_dispose_timer!=null){clearTimeout(wgrid_dispose_timer);wgrid_dispose_timer=null}if(wgrid_host==null){return}if(wgrid_visible){return}wgrid_host.setStyle("display","");wgrid_visible=true}function wgrid_hide(){if(!wgrid_visible){return}wgrid_dispose_timer=window.setTimeout(function(){try{wgrid_host.setStyle("display","none");wgrid_visible=false}catch(a){}},200)}function wgrid_dispose(a){try{$each(wgrid_elements,function(c){c.remove()});wgrid_host.remove()}catch(b){}if(wgrid_dispose_timer!=null){clearTimeout(wgrid_dispose_timer);wgrid_dispose_timer=null}wgrid_elements=[];wgrid_host=null;wgrid_pos={x:0,y:0};wgrid_visible=false;if(!$defined(a)){wgrid_last_design_pos={x:0,y:0}}}function wgrid_put(a,f,b,c){var d=$(document.createElement("a"));d.setProperty("href","javascript:;");d.setHTML("&nbsp;");d.addEvent("click",function(g){var g=new Event(g);wgrid_dispose();gloryIO(b,{id:c.id},true);g.stop()});wgrid_host.appendChild(d);d.setStyles({left:a*32,top:f*32,display:"block",width:32,height:32,"background-color":"#00FF00",position:"absolute",opacity:0.5,"text-decoration":"none"});if($defined(c.color)){d.setStyle("background-color",c.color)}if($defined(c.title)){d.setProperty("title",c.title)}wgrid_elements.push(d)}function wgrid_design(c,a){var b=[];wgrid_hard_dispose=a;wgrid_dispose(true);wgrid_host=$(document.createElement("div"));wgrid_host.setStyles({position:"absolute",visibility:"visible","background-color":"#000000",left:0,top:0,"z-index":lastZ++});$("datapane").appendChild(wgrid_host);if(!a){wgrid_host.addEvent("mouseleave",function(d){wgrid_hide()});wgrid_host.addEvent("mouseenter",function(d){wgrid_show()})}$each(c.grid,function(d){wgrid_put(d.x,d.y,c.base,d)});wgrid_visible=true}var hoverInfo={text:"",x:0,y:0,sz:{x:0,y:0}};function hoverShow(e,a,g,f){var b=$("hoverLayer");if(e){if(hoverInfo.text!=e){hoverInfo.text=e;b.setHTML(e);hoverInfo.sz=b.getSize().size;b.setStyles({visibility:"visible"})}if(hoverInfo.x!=a||hoverInfo.y!=g){hoverInfo.x=a;hoverInfo.y=g;var d=a-(hoverInfo.sz.x/2);var c=g-hoverInfo.sz.y-12;if(c<0){c+=hoverInfo.sz.y+12}if(!f||(f=="center")){d=a-(hoverInfo.sz.x/2)}else{if(f=="left"){d=a}else{if(f=="right"){d=a-hoverInfo.sz.x}}}b.setStyles({left:d,top:c,"z-index":lastZ})}}else{if(hoverInfo.text!=""){hoverInfo={text:"",x:0,y:0,sz:{x:0,y:0}};b.setStyles({visibility:"hidden"})}}}var dropdownInfo={visible:false};function dropdownShow(b,f,c,a,e){if(!e){e=0}var d=$("dropdownLayer");d.setHTML('<img src="images/UI/loading2.gif" align="absmiddle" />');d.setStyles({visibility:"visible",left:b-5,top:f-5});dropdownInfo.visible=true;gloryIO("?a=interface.dropdown&guid="+c+"&pos="+a+"&parent="+e,false,true);d.focus();d.addEvent("mouseleave",function(){disposeDropDown()})}function disposeDropDown(){var a=$("dropdownLayer");if(dropdownInfo.visible){a.setStyles({visibility:"hidden"});dropdownInfo.visible=false}}var regions=[];var visibleRegionID=-1;var activeEvent=false;var region_showing=false;var region_showing_fx=null;function stackRegion(a){regions.push(a)}function resetRegion(){disposeActionPane();regions=[];visibleRegionID=-1}function hitTestRegion(a,c){if(visibleRegionID>-1){if(region_showing){if((a!=regions[visibleRegionID].show.x)||(c!=regions[visibleRegionID].show.y)){abortActionPaneRender()}}return}for(var b=0;b<regions.length;b++){if((regions[b].show.x==a)&&(regions[b].show.y==c)){showRegion(b);return}}}function showRegion(a){renderActionRange(regions[a]);visibleRegionID=a;hoverShow(false)}function disposeActionPane(c){if(visibleRegionID==-1){return}var a=$("actionpane");if(!c){var b=new Fx.Styles(a,{duration:500,transition:Fx.Transitions.Cubic.easeOut});b.start({opacity:0}).chain(function(){a.setStyles({visibility:"hidden"})})}else{a.setStyles({visibility:"hidden"})}visibleRegionID=-1}function renderActionRange(c){hoverShow();try{var a=0;var g=0;var f='<table cellspacing="0" cellpadding="0">';for(g=c.y.m;g<=c.y.M;g++){f+="<tr>";for(a=c.x.m;a<=c.x.M;a++){if($defined(c.grid[g])){if($defined(c.grid[g][a])){var b="";if($defined(c.grid[g][a].c)){b+="background-color:"+c.grid[g][a].c+"; "}if($defined(c.grid[g][a].b)){b+="background-image:url("+c.grid[g][a].b+"); "}f+='<td><a href="javascript:void(0);" onclick=";gloryIO(\'?a='+c.action+"&id="+c.grid[g][a].i+'\');" class="actgrid_link" style="'+b+'">';if($defined(c.grid[g][a].t)){f+=c.grid[g][a].t}else{f+="&nbsp;"}f+="</a></td>"}else{f+='<td><div class="actgrid_div">&nbsp;</div></td>'}}else{f+='<td><div class="actgrid_div">&nbsp;</div></td>'}}f+="</tr>"}f+="</table>";renderActionPane(f,c.point.x-glob_x_base,c.point.y-glob_y_base)}catch(d){window.alert("RenderActionRange Error: "+d)}}function renderActionPane(c,a,f){var b=$("actionpane");var e=$("datapane").getLeft();var d=$("datapane").getTop();b.setHTML(c);b.setStyles({visibility:"visible",opacity:0,left:(a*32-12)+e,top:(f*32-12)+d});b.addEvent("click",function(g){g=new Event(g);g.stop()});b.addEvent("mouseleave",function(g){g=new Event(g);disposeActionPane();g.stop()});region_showing_fx=new Fx.Styles("actionpane",{duration:500,transition:Fx.Transitions.Cubic.easeIn,onComplete:function(){region_showing=false}});region_showing=true;region_showing_fx.start({opacity:0.8}).chain(function(){hoverShow(false)})}function abortActionPaneRender(){if(region_showing){region_showing_fx.stop();region_showing=false;disposeActionPane(true)}}var feeder_interval=5000;var feeder_timer=0;var feeder_enabled=true;var iD=0;function reset_feeder(){if(feeder_timer){clearTimeout(feeder_timer)}if(feeder_enabled){feeder_timer=setTimeout(feeder,feeder_interval)}}function feeder(){iD++;$("prompt").setHTML("Feeded: "+iD);gloryIO("msgfeed.php",false,true,function(a){reset_feeder()})}var pie_stack=[];var pie_info=[];var pie_wait_icon=null;var pie_menutext=null;var pie_visible=false;function piemenu_dispose(){if(pie_stack.length>=0){for(var a=0;a<pie_stack.length;a++){var b=new Fx.Styles(pie_stack[a],{duration:400,transition:Fx.Transitions.Back.easeIn,onComplete:function(){this.element.remove()}});b.start({opacity:0,left:pie_info.x-17,top:pie_info.y-17})}pie_stack=[]}pie_info=[];if(pie_menutext){var b=new Fx.Styles(pie_menutext,{duration:400,transition:Fx.Transitions.Back.easeIn,onComplete:function(){this.element.remove()}});b.start({opacity:0});pie_menutext=null}piemenu_waitdispose();pie_visible=false}function piemenu_spawnicon(h,f,g,i,a){try{var j=$(document.createElement("div"));j.setStyles({width:"34px",height:"34px",position:"absolute","background-repeat":"no-repeat","background-image":"url(images/UI/icon-bg.png)","text-align":"center",left:(pie_info.x-17)+"px",top:(pie_info.y-17)+"px",opacity:0,"z-index":lastZ++});var b=new Fx.Styles(j,{duration:400,transition:Fx.Transitions.Back.easeOut});var c=$(document.createElement("a"));c.setProperty("href","javascript:;");c.addEvent("click",function(k){k=new Event(k);piemenu_dispose();gloryIO(a);k.stop()});c.alt=i;c.title=i;var e=$(document.createElement("img"));e.src=g;e.border="0";c.appendChild(e);j.appendChild(c);pie_stack.push(j);$(document.body).appendChild(j);b.start({opacity:1,left:h-17+"px",top:f-17+"px"})}catch(d){}}function piemenu_show(c,l){pie_visible=true;try{piemenu_waitdispose();hoverShow();if(pie_info.length==0){return}var a=5+(c.length*5);if(l!=""){if(pie_menutext){pie_menutext.remove();pie_menutext=null}pie_menutext=$(document.createElement("div"));pie_menutext.setStyles({position:"absolute","background-color":"#000000","boder-width":"2px","border-style":"solid","border-color":"#CCCCCC","font-size":"10px",padding:"2px",opacity:0,"text-align":"center","z-index":lastZ++});var d=new Fx.Styles(pie_menutext,{duration:400,transition:Fx.Transitions.Back.easeIn});if(c.length>0){pie_menutext.setStyles({width:((a*2)+60)+"px"})}pie_menutext.setHTML(l);document.body.appendChild(pie_menutext);var k=pie_menutext.getSize();pie_menutext.setStyles({left:(pie_info.x-(k.size.x/2)),top:(pie_info.y+a+15)});d.start({opacity:1})}if(c.length>0){var f=(2*Math.PI)/c.length;var h=0;for(var g=0;g<c.length;g++){var e=pie_info.x+(a*Math.cos(h));var b=pie_info.y+(a*Math.sin(h));piemenu_spawnicon(e,b,c[g][0],c[g][1],c[g][2]);h+=f}}}catch(j){}}function piemenu_waitdispose(){try{if(pie_wait_icon){pie_wait_icon.remove();pie_wait_icon=null}}catch(a){}}function piemenu_wait(){piemenu_waitdispose();pie_wait_icon=$(document.createElement("img"));pie_wait_icon.src="images/UI/loading-big.gif";$(document.body).appendChild(pie_wait_icon);var a=pie_wait_icon.getSize();pie_wait_icon.setStyles({left:(pie_info.x-(a.size.x/2))+"px",top:(pie_info.y-(a.size.y/2))+"px",position:"absolute"})}function piemenu_init(b,e,c,a,d){pie_info={x:b,y:e};gloryIO("?a=interface.dropdown&guid="+c+"&pos="+a+"&parent="+d,false,true);piemenu_wait()}var hoveredItem=false;$(window).addEvent("load",function(a){initWaiter();initDisplayBuffer();$("datapane").addEvent("contextmenu",function(c){c=new Event(c);var b=getScrollPosition();if(hoveredItem!=false){piemenu_dispose();piemenu_init(c.event.clientX+b.x,c.event.clientY+b.y,hoveredItem.g,"MAP")}else{piemenu_dispose()}c.stop()});$("datapane").addEvent("mousedown",function(b){piemenu_dispose()});$("datapane").addEvent("click",function(f){f=new Event(f);var h=$("datapane").getLeft();var g=$("datapane").getTop();var c=getScrollPosition();var b=Math.ceil((f.event.clientX-h+c.x)/32)+glob_x_base-1;var d=Math.ceil((f.event.clientY-g+c.y)/32)+glob_y_base-1;if(rectinfo.url==""){hitTestRegion(b,d)}else{gloryIO(rectinfo.url+"&x="+b+"&y="+d);if(rectinfo.clickdispose){rectinfo.url="";$("grid_rect").setStyles({display:"none"})}}piemenu_dispose()});gloryIO("?a=map.grid.get");feeder()});$(window).addEvent("focus",function(a){return;feeder_enabled=true;if(feeder_timer==0){feeder_timer=setTimeout(feeder,1000)}});$(window).addEvent("blur",function(a){return;feeder_enabled=false;feeder_timer=0});var v_center={x:0,y:0},v_last={x:0,y:0};$(document).addEvent("keydown",function(c){c=new Event(c);if(c.code==27){var b=$("grid_rect");if(b){if(b.getStyle("display")!="none"){b.setStyles({display:"none"});rectinfo.url=""}}piemenu_dispose();c.stop()}else{if(c.control){if(c.key=="b"){c.stop();gloryIO("?a=interface.inventory")}else{if(c.key=="d"){c.stop();window.alert($trace(map_objects))}}}else{if(c.key=="right"){v_center.x=200;c.stop()}else{if(c.key=="left"){v_center.x=-200;c.stop()}else{if(c.key=="up"){v_center.y=-200;c.stop()}else{if(c.key=="down"){v_center.y=200;c.stop()}else{if(c.key=="m"){var d=map_object_index.indexOf(map_playeruid);if(d>-1){var a=getScrollPosition();if($defined(map_objects[d].info.range)){if(!wgrid_visible){wgrid_design(map_objects[d].info.range);wgrid_show()}}}}}}}}}}if((v_center.x!=v_last.x)||(v_center.y!=v_last.y)){map_center(map_viewpoint.x+v_center.x,map_viewpoint.y+v_center.y);v_last.x=v_center.x;v_last.y=v_center.y}});$(document).addEvent("keyup",function(a){v_center={x:0,y:0};v_last={x:0,y:0};map_center(map_viewpoint.x,map_viewpoint.y)});$(document).addEvent("mouseup",function(a){piemenu_dispose();wgrid_hide()});$(document).addEvent("contextmenu",function(a){var a=new Event(a);piemenu_dispose();wgrid_hide()});$(document).addEvent("mousemove",function(h){try{h=new Event(h);var l=$("datapane").getLeft();var k=$("datapane").getTop();var d=getScrollPosition();var c=Math.ceil((h.event.clientX-l+d.x)/32)-1;var i=Math.ceil((h.event.clientY-k+d.y)/32)-1;var j=c+glob_x_base;var f=i+glob_y_base;var b="";var g="";if($defined(nav_grid[j])){if($defined(nav_grid[j][f-1])){b=nav_grid[j][f-1];g=nav_grid.dic[b]}}if(g.d){hoveredItem=g}else{hoveredItem=false}if(!pie_visible){hitTestRegion(j,f);if(hoveredItem){$("prompt").setHTML("X: "+j+", Y: "+f+" With Zero at: "+glob_x_base+","+glob_y_base+", Overlay: "+b+" Dic:"+g.d.name);hoverShow(g.d.name,h.event.clientX+d.x,h.event.clientY+d.y)}else{$("prompt").setHTML("X: "+j+", Y: "+f+" With Zero at: "+glob_x_base+","+glob_y_base);hoverShow(false)}var a=$("grid_rect");if(a){if(a.getStyle("display")!="none"){a.setStyles({left:(c-rectinfo.bx)*32,top:(i-rectinfo.by)*32,width:rectinfo.w*32,height:rectinfo.h*32,display:""})}}}}catch(h){}});function display(a){gloryIO("index.php?"+a)};