/* GloryLands API Javascript API - Compressed with YUI compressor */ 
 
var isInternetExplorer=(navigator.userAgent.indexOf("MSIE")>=0);var isMozilla=(navigator.userAgent.indexOf("Gecko")>=0);var isOpera=(navigator.userAgent.indexOf("Opera")>=0);function $trace(a){ans="";$each(a,function(c,b){if(ans!=""){ans+=", "}ans+="["+b+"] = "+c});return ans}var CBChain=new Class({initialize:function(){this.chain=[]},register:function(b,a){if(!$defined(this.chain[b])){this.chain[b]=[]}this.chain[b].push(a)},call:function(b,a){if($defined(this.chain[b])){this.chain[b].each(function(c){c(a)})}}});var callback=new CBChain();function getScrollPosition(){var b=0;var c=0;if(typeof(window.pageYOffset)=="number"){b=window.pageXOffset;c=window.pageYOffset}else{if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){b=document.documentElement.scrollLeft;c=document.documentElement.scrollTop}else{if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){b=document.body.scrollLeft;c=document.body.scrollTop}}}var a={x:b,y:c};return a}var waiterShown=false;var waiterFX=false;var waiterDisposer=0;function initWaiter(){waiterFX=new Fx.Styles("waiter",{duration:400,transition:Fx.Transitions.Back.easeIn,onComplete:function(){if(!waiterShown){$("waiter_host").setStyles({display:"none"})}}});$("waiter_host").setStyles({display:"none"})}function showStatus(c,a){try{if(waiterDisposer>0){clearTimeout(waiterDisposer);waiterDisposer=0}if(!c){if(waiterShown){waiterShown=false;waiterFX.stop();waiterFX.start({opacity:0})}}else{$("waiter").setHTML(c);if(!waiterShown){$("waiter_host").setStyles({display:""});waiterShown=true;waiterFX.stop();waiterFX.start({opacity:1})}if(a){waiterDisposer=setTimeout(function(){showStatus()},a)}}}catch(b){}}var winCache=[];var lastZ=1000;function createWindow(f,i,o,l,p,g,k){if(!winCache[f]){var a=document.createElement("div");var e=document.createElement("div");var c=document.createElement("span");var n=document.createElement("a");var m=document.createElement("a");if(!isInternetExplorer){a.setAttribute("class","container");e.setAttribute("class","dragger");c.setAttribute("class","content");n.setAttribute("class","toggle");m.setAttribute("class","dispose")}else{a.setAttribute("className","container");e.setAttribute("className","dragger");c.setAttribute("className","content");n.setAttribute("className","toggle");m.setAttribute("className","dispose")}n.setAttribute("title","Minimize");m.setAttribute("title","Close");e.innerHTML='<span align="top" class="left">&nbsp;</span><span class="center">'+f+'</span><span class="right">&nbsp;</span>';a.appendChild(e);a.appendChild(c);c.innerHTML=i;if(!isMozilla){var b=new Fx.Slide(c)}n.setAttribute("href","javascript:;");n.innerHTML="&nbsp;";e.appendChild(n);$(n).addEvent("click",function(d){d=new Event(d);if(!isMozilla){b.toggle()}else{if(c.style.display=="none"){c.style.display=""}else{c.style.display="none"}}d.stop()});m.setAttribute("href","javascript:void(null)");m.innerHTML="&nbsp;";e.appendChild(m);$(m).addEvent("click",function(d){d=new Event(d);gloryIO("?a=window.closed&guid="+k,false,true);a.remove();winCache[f]=false;d.stop()});$(e).addEvent("mousedown",function(d){a.setStyles({opacity:0.7,"z-index":lastZ++})});$(e).addEvent("mouseup",function(d){a.setStyles({opacity:1})});$(a).addEvent("mousedown",function(d){a.setStyles({"z-index":lastZ++})});if(o){a.setStyles({left:o})}if(l){a.setStyles({top:l})}if(p){a.setStyles({width:p})}if(g){a.setStyles({height:g})}a.setStyles({"z-index":lastZ++});document.body.appendChild(a);var j=new Drag.Move(a,{handle:e});winCache[f]=[a,c,b];return a}else{var a=winCache[f][0];var c=winCache[f][1];var b=winCache[f][2];if(!isMozilla){b.slideIn()}else{c.style.display=""}c.innerHTML=i;if(p){a.setStyles({width:p})}if(g){a.setStyles({height:g})}}}var data_cache=new Array();var ex_buffer_data="";function initDisplayBuffer(){ex_buffer_data=$("datapane").innerHTML}function displayBuffer(b,e,a,d,c){var f=b;if(e){data_cache.push($("datapane").innerHTML);f+='<span class="maplabel"><a class="navlink" href="javascript:restoreview();" title="Return to previous window"><img align="absmiddle" src="images/UI/navbtn_back.gif" /></a> Return</span>'}else{data_cache=new Array();if(c!=""){if(a!=""){if(d!=""){f+='<span class="maplabel"><a class="navlink" href="javascript:gloryIO(\''+a+'\',false,true);"><img align="absmiddle" src="images/'+d+'" /></a> '+c+"</span>"}else{f+='<span class="maplabel"><a class="navlink" href="javascript:gloryIO(\''+a+"',false,true);\"> "+c+"</a></span>"}}else{if(d!=""){f+='<span class="maplabel"><img align="absmiddle" src="images/'+d+'" /> '+c+"</span>"}else{f+='<span class="maplabel"> '+c+"</span>"}}}}f+=ex_buffer_data;$("datapane").innerHTML=f}function restoreview(){if(data_cache.length<1){return}var a=data_cache.pop();$("datapane").innerHTML=a}var ddw_visible=false;function ddwin_dispose(){if(ddw_visible){var a=new Fx.Styles("dd_popup",{duration:500,transition:Fx.Transitions.Cubic.easeOut});var d=new Fx.Styles("dd_content",{duration:500,transition:Fx.Transitions.Cubic.easeOut});var b=$("dd_popup");var c=$("dd_host");var e=$("dd_content");d.start({opacity:0}).chain(function(){e.setHTML("");a.start({opacity:0,width:10,height:10}).chain(function(){c.setStyles({display:"none"})})});ddw_visible=false}}function ddwin_show(d,a,h){var c=$("dd_popup");var g=$("dd_content");var f=$("dd_host");var b=new Fx.Styles("dd_popup",{duration:500,transition:Fx.Transitions.Cubic.easeOut});var e=new Fx.Styles("dd_content",{duration:500,transition:Fx.Transitions.Cubic.easeOut});if(ddw_visible){e.start({opacity:0}).chain(function(){b.start({height:a,width:d,opacity:1}).chain(function(){g.setHTML('<div style="position:relative; width:100%; height:100%"><span class="dd_head"><a href="javascript:ddwin_dispose()">X</a></span>'+h+"</div>");e.start({opacity:1})})})}else{f.setStyles({display:""});c.setStyles({opacity:0,width:10,height:10});g.setStyles({opacity:0,display:"none"});g.setHTML('<div style="position:relative; width:100%; height:100%"><span class="dd_head"><a href="javascript:ddwin_dispose()">X</a></span>'+h+"</div>");b.start({opacity:1,width:d,height:a}).chain(function(){g.setStyles({display:""});e.start({opacity:1})});ddw_visible=true}}function ddwin_prepare(){var b=$("dd_popup");var e=$("dd_content");var d=$("dd_host");var a=new Fx.Styles("dd_popup",{duration:500,transition:Fx.Transitions.Cubic.easeOut});var c=new Fx.Styles("dd_content",{duration:500,transition:Fx.Transitions.Cubic.easeOut});if(!ddw_visible){d.setStyles({display:""});b.setStyles({opacity:0});e.setStyles({opacity:1});e.setHTML('Please&nbsp; <img src="images/UI/loading2.gif" align="absmiddle" /> &nbsp;wait...');a.start({opacity:1});ddw_visible=true}else{c.start({opacity:0}).chain(function(){e.setHTML('Please&nbsp; <img src="images/UI/loading2.gif" align="absmiddle" /> &nbsp;wait...');c.start({opacity:1})})}}var msgstack=[];var msglocked=false;function lockMessages(a){msglocked=a;if(!a){$each(msgstack,function(b,c){handleMessages(b)});msgstack=[]}}function handleMessages(c){if(msglocked){msgstack.push(c);return}var g="",m="";for(var f=0;f<c.count;f++){if($defined(c.message[f])){g=c.message[f][0];m=c.message[f][1];if(g=="MSGBOX"){window.alert(m)}else{if(g=="POPUP"){var b=310;if($defined(c.message[f][3])){b=c.message[f][3]}var d=(screen.width-b)/2;var l=120;var k=false;if($defined(c.message[f][4])){if(c.message[f][4]!=false){d=c.message[f][4]}}if($defined(c.message[f][5])){if(c.message[f][5]!=false){l=c.message[f][5]}}if($defined(c.message[f][6])){if(c.message[f][6]!=false){k=c.message[f][6]}}createWindow(c.message[f][2],c.message[f][1],d,l,b,false,k)}else{if(g=="CALL"){var j=true;if($defined(c.message[f][2])){j=c.message[f][2]}gloryIO(m,false,j)}else{if(g=="NAVIGATE"){window.location="index.php?a="+m}else{if(g=="UPDATEGRID"){gloryIO("?a=map.grid.get&quick=1",false,true)}else{if(g=="RECT"){var a=$("grid_rect");try{if($defined(a)){if(m){rectinfo.w=1;rectinfo.h=1;rectinfo.bx=0;rectinfo.by=0;rectinfo.url="";rectinfo.clickdispose=true;rectinfo.silent=false;if($defined(c.message[f][2])){rectinfo.url=c.message[f][2]}if($defined(c.message[f][3])){rectinfo.w=c.message[f][3]}if($defined(c.message[f][4])){rectinfo.h=c.message[f][4]}if($defined(c.message[f][5])){rectinfo.bx=c.message[f][5]}if($defined(c.message[f][6])){rectinfo.by=c.message[f][6]}if($defined(c.message[f][7])){rectinfo.clickdispose=c.message[f][7]}if($defined(c.message[f][8])){rectinfo.silent=c.message[f][8]}a.setStyles({display:""})}else{a.setStyles({display:"none"})}}}catch(h){window.alert(h)}}else{if(g=="RANGE"){if($defined(c.message[f][1])){stackRegion(c.message[f][1])}}else{if(g=="POLLINTERVAL"){feeder_interval=c.message[f][1]}else{callback.call("message",c.message[f])}}}}}}}}}}}var data_io_time=0;function gloryIO(b,f,a,d){try{reset_feeder();if(!a){showStatus('Loading...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/UI/mouseloading.gif" />')}data_io_time=$time();var c=new Json.Remote(b,{headers:{"X-Request":"JSON"},onComplete:function(l){showStatus();data_io_time=$time()-data_io_time;var n="NONE";if($defined(l.mode)){n=l.mode}if(n=="POPUP"){var j=100;var r=20;var i=310;var v=false;var q=false;if($defined(l.left)){j=l.left}if($defined(l.top)){r=l.top}if($defined(l.width)){i=l.width}if($defined(l.height)){i=l.height}if($defined(l.guid)){q=l.guid}createWindow(l.title,l.text,j,r,i,v,q)}else{if(n=="MAIN"){var t=true;var m="";var p="";var s="";if($defined(l.rollback)){t=l.rollback}if($defined(l.head_link)){m=l.head_link}if($defined(l.head_image)){p=l.head_image}if($defined(l.title)){s=l.title}nav_grid=[];overlay_grid=[];resetRegion();piemenu_dispose();disposeActionPane();displayBuffer(l.text,t,m,p,s)}else{if(n=="INFO"){}else{if(n=="FULL"){}else{if(n=="BLANK"){}else{if(n=="NONE"){}else{if(n=="GRID"){resetRegion();lockMessages(true);var t=false;var m="";var p="";var s="";var h="none.gif";if($defined(l.rollback)){t=l.rollback}if($defined(l.head_link)){m=l.head_link}if($defined(l.head_image)){p=l.head_image}if($defined(l.title)){s=l.title}if($defined(l.background)){h=l.background}grid_display.rollback=t;grid_display.head_link=m;grid_display.head_image=p;grid_display.background=h;grid_display.title=s;if($defined(l.data)){overlay_grid=l.data}if($defined(l.nav)){nav_grid=l.nav}if($defined(l.x)){grid_x=l.x}if($defined(l.y)){grid_y=l.y}if($defined(l.map)){if(current_map!=l.map){loadGrid(l.map)}else{showStatus("Updating Grid");setTimeout(renderUpdate,100)}}else{setTimeout(renderUpdate,100)}}else{if(n=="DEDICATED"){var v=210;var i=400;if($defined(l.height)){v=l.height}if($defined(l.width)){i=l.width}try{ddwin_show(i,v,l.text)}catch(o){window.alert(o)}}else{if(n=="DROPDOWN"){var k=[];var u=[];if($defined(l.menus)){k=l.menus}if($defined(l.text)){u=l.text}if(pie_wait_icon){piemenu_show(k,u)}}else{callback.call("ioreply",l)}}}}}}}}}if($defined(l.messages)){handleMessages(l.messages)}if(d){d(l)}},onFailure:function(e){if(!a){showStatus('<font color="red">Connection failure!</font>',1000)}if(d){d(false)}}}).send(f)}catch(g){if(!a){showStatus('<font color="red">Data Error!</font>',1000)}}}var data_grid=false;var collision_grid=false;var data_dictionary=false;var grid_range=false;var overlay_grid=false;var nav_grid=false;var current_map="";var glob_x_base=0;var glob_y_base=0;var grid_x=0,grid_y=0;var grid_display={rollback:false,head_link:false,head_image:false,title:false,background:"none.gif"};var rectinfo={w:3,h:3,bx:1,by:2,url:"",clickdispose:false,silent:false};function gridClick(a,b){gloryIO("?a=map.grid.get&x="+a+"&y="+b)}function loadGrid(b){current_map=b;showStatus("Loading Map...");var a=new Json.Remote("data/maps/"+b+".jmap",{onComplete:function(c){data_grid=c.grid;collision_grid=c.zid;data_dictionary=c.dic;grid_range=c.range;showStatus("Loading Graphics...");setTimeout(processDictionary,100)},onFailure:function(c){showStatus('<font color="red">Map Transaction Error!</font>',1000);data_grid=false;collision_grid=false;data_dictionary=false}}).send()}function processDictionary(){var a=new Array();for(img in data_dictionary){if($defined(img)){a.push("images/tiles/"+img)}else{a.push("images/tiles/blank.gif")}}data_dictionary=a;showStatus("Loading Graphics...");var b=0;new Asset.images(a,{onComplete:function(){showStatus("Updating Grid");setTimeout(renderUpdate,100);if(b>0){clearTimeout(b)}},onProgress:function(d){var c=Math.ceil(100*d/a.length);if(c>100){c-=100}showStatus("Loading Graphics ["+c+" %]");if(b>0){clearTimeout(b)}b=setTimeout(renderUpdate,2000)}})}function level2_sort(d,c){return d[0]-c[0]}function renderUpdate(){var c=24;var f=16;var g=grid_x-(c/2);var e=grid_y-(f/2);if(!grid_range||!$defined(grid_range.x)){showStatus('<font color="red">Map cannot be loaded!</font><br />',5000);return false}if(g<grid_range.x.m){g=grid_range.x.m}if(g+c>grid_range.x.M){g=grid_range.x.M-c}if(e<grid_range.y.m){e=grid_range.y.m}if(e+f>grid_range.y.M){e=grid_range.y.M-f}glob_x_base=g;glob_y_base=e;var d='<table cellspacing="0" cellpadding="0" id="tbl" style="background-image: url(images/tiles/'+grid_display.background+');">';for(var h=e;h<e+f;h++){d+="<tr>";for(var b=g;b<g+c;b++){d+="<td><div>";var a=new Array();if($defined(data_grid[h])){if($defined(data_grid[h][b])){$each(data_grid[h][b],function(i,j){a.push([j,data_dictionary[i]])})}}if($defined(overlay_grid[h])){if($defined(overlay_grid[h][b])){$each(overlay_grid[h][b],function(i,j){a.push([j,"images/tiles/"+i])})}}if(a.length>0){a.sort(level2_sort);a.each(function(i){d+='<img src="'+i[1]+'">'})}d+="</div></td>"}d+="</tr>"}d+="</table>";d+='<div id="grid_rect" class="dbf_container" style="border-width: 2px; border-style: solid; border-color: #FF0000; position: absolute; display: none"></div>';displayBuffer(d,grid_display.rollback,grid_display.head_link,grid_display.head_image,grid_display.title);showStatus();lockMessages(false)}var hoverInfo={text:"",x:0,y:0,sz:{x:0,y:0}};function hoverShow(c,a,d){var b=$("hoverLayer");if(c){if(hoverInfo.text!=c){hoverInfo.text=c;b.setHTML(c);hoverInfo.sz=b.getSize().size;b.setStyles({visibility:"visible"})}if(hoverInfo.x!=a||hoverInfo.y!=d){hoverInfo.x=a;hoverInfo.y=d;b.setStyles({left:a-(hoverInfo.sz.x/2),top:d-hoverInfo.sz.y-12})}}else{if(hoverInfo.text!=""){hoverInfo={text:"",x:0,y:0,sz:{x:0,y:0}};b.setStyles({visibility:"hidden"})}}}var dropdownInfo={visible:false};function dropdownShow(b,f,c,a,e){if(!e){e=0}var d=$("dropdownLayer");d.setHTML('<img src="images/UI/loading2.gif" align="absmiddle" />');d.setStyles({visibility:"visible",left:b-5,top:f-5});dropdownInfo.visible=true;gloryIO("?a=interface.dropdown&guid="+c+"&pos="+a+"&parent="+e,false,true);d.focus();d.addEvent("mouseleave",function(){disposeDropDown()})}function disposeDropDown(){var a=$("dropdownLayer");if(dropdownInfo.visible){a.setStyles({visibility:"hidden"});dropdownInfo.visible=false}}var regions=[];var visibleRegionID=-1;var activeEvent=false;var region_showing=false;var region_showing_fx=null;function stackRegion(a){regions.push(a)}function resetRegion(){disposeActionPane();regions=[];visibleRegionID=-1}function hitTestRegion(a,c){if(visibleRegionID>-1){if(region_showing){if((a!=regions[visibleRegionID].show.x)||(c!=regions[visibleRegionID].show.y)){abortActionPaneRender()}}return}for(var b=0;b<regions.length;b++){if((regions[b].show.x==a)&&(regions[b].show.y==c)){showRegion(b);return}}}function showRegion(a){renderActionRange(regions[a]);visibleRegionID=a;hoverShow(false)}function disposeActionPane(c){if(visibleRegionID==-1){return}var a=$("actionpane");if(!c){var b=new Fx.Styles(a,{duration:500,transition:Fx.Transitions.Cubic.easeOut});b.start({opacity:0}).chain(function(){a.setStyles({visibility:"hidden"})})}else{a.setStyles({visibility:"hidden"})}visibleRegionID=-1}function renderActionRange(c){hoverShow();try{var a=0;var g=0;var f='<table cellspacing="0" cellpadding="0">';for(g=c.y.m;g<=c.y.M;g++){f+="<tr>";for(a=c.x.m;a<=c.x.M;a++){if($defined(c.grid[g])){if($defined(c.grid[g][a])){var b="";if($defined(c.grid[g][a].c)){b+="background-color:"+c.grid[g][a].c+"; "}if($defined(c.grid[g][a].b)){b+="background-image:url("+c.grid[g][a].b+"); "}f+='<td><a href="javascript:void(0);" onclick=";gloryIO(\'?a='+c.action+"&id="+c.grid[g][a].i+'\');" class="actgrid_link" style="'+b+'">';if($defined(c.grid[g][a].t)){f+=c.grid[g][a].t}else{f+="&nbsp;"}f+="</a></td>"}else{f+='<td><div class="actgrid_div">&nbsp;</div></td>'}}else{f+='<td><div class="actgrid_div">&nbsp;</div></td>'}}f+="</tr>"}f+="</table>";renderActionPane(f,c.point.x-glob_x_base,c.point.y-glob_y_base)}catch(d){window.alert(d)}}function renderActionPane(c,a,f){var b=$("actionpane");var e=$("datapane").getLeft();var d=$("datapane").getTop();b.setHTML(c);b.setStyles({visibility:"visible",opacity:0,left:(a*32-12)+e,top:(f*32-12)+d});b.addEvent("click",function(g){g=new Event(g);g.stop()});b.addEvent("mouseleave",function(g){g=new Event(g);disposeActionPane();g.stop()});region_showing_fx=new Fx.Styles("actionpane",{duration:500,transition:Fx.Transitions.Cubic.easeIn,onComplete:function(){region_showing=false}});region_showing=true;region_showing_fx.start({opacity:0.8}).chain(function(){hoverShow(false)})}function abortActionPaneRender(){if(region_showing){region_showing_fx.stop();region_showing=false;disposeActionPane(true)}}var feeder_interval=5000;var feeder_timer=0;var feeder_enabled=true;var iD=0;function reset_feeder(){if(feeder_timer){clearTimeout(feeder_timer)}if(feeder_enabled){feeder_timer=setTimeout(feeder,feeder_interval)}}function feeder(){iD++;$("prompt").setHTML("Feeded: "+iD);gloryIO("msgfeed.php",false,true,function(a){reset_feeder()})}var pie_stack=[];var pie_info=[];var pie_wait_icon=null;var pie_menutext=null;var pie_visible=false;function piemenu_dispose(){if(pie_stack.length>=0){for(var a=0;a<pie_stack.length;a++){var b=new Fx.Styles(pie_stack[a],{duration:400,transition:Fx.Transitions.Back.easeIn,onComplete:function(){this.element.remove()}});b.start({opacity:0,left:pie_info.x-17,top:pie_info.y-17})}pie_stack=[]}pie_info=[];if(pie_menutext){var b=new Fx.Styles(pie_menutext,{duration:400,transition:Fx.Transitions.Back.easeIn,onComplete:function(){this.element.remove()}});b.start({opacity:0});pie_menutext=null}piemenu_waitdispose();pie_visible=false}function piemenu_spawnicon(h,f,g,i,a){try{var j=$(document.createElement("div"));j.setStyles({width:"34px",height:"34px",position:"absolute","background-repeat":"no-repeat","background-image":"url(images/UI/icon-bg.png)","text-align":"center",left:(pie_info.x-17)+"px",top:(pie_info.y-17)+"px",opacity:0,"z-index":lastZ++});var b=new Fx.Styles(j,{duration:400,transition:Fx.Transitions.Back.easeOut});var c=$(document.createElement("a"));c.setAttribute("href","javascript:;");c.addEvent("click",function(k){k=new Event(k);piemenu_dispose();gloryIO(a);k.stop()});c.alt=i;c.title=i;var e=$(document.createElement("img"));e.src=g;e.border="0";c.appendChild(e);j.appendChild(c);pie_stack.push(j);$(document.body).appendChild(j);b.start({opacity:1,left:h-17+"px",top:f-17+"px"})}catch(d){}}function piemenu_show(c,l){pie_visible=true;try{piemenu_waitdispose();hoverShow();if(pie_info.length==0){return}var a=5+(c.length*5);if(l!=""){if(pie_menutext){pie_menutext.remove();pie_menutext=null}pie_menutext=$(document.createElement("div"));pie_menutext.setStyles({position:"absolute","background-color":"#000000","boder-width":"2px","border-style":"solid","border-color":"#CCCCCC","font-size":"10px",padding:"2px",opacity:0,"text-align":"center","z-index":lastZ++});var d=new Fx.Styles(pie_menutext,{duration:400,transition:Fx.Transitions.Back.easeIn});if(c.length>0){pie_menutext.setStyles({width:((a*2)+60)+"px"})}pie_menutext.setHTML(l);document.body.appendChild(pie_menutext);var k=pie_menutext.getSize();pie_menutext.setStyles({left:(pie_info.x-(k.size.x/2)),top:(pie_info.y+a+15)});d.start({opacity:1})}if(c.length>0){var f=(2*Math.PI)/c.length;var h=0;for(var g=0;g<c.length;g++){var e=pie_info.x+(a*Math.cos(h));var b=pie_info.y+(a*Math.sin(h));piemenu_spawnicon(e,b,c[g][0],c[g][1],c[g][2]);h+=f}}}catch(j){}}function piemenu_waitdispose(){try{if(pie_wait_icon){pie_wait_icon.remove();pie_wait_icon=null}}catch(a){}}function piemenu_wait(){piemenu_waitdispose();pie_wait_icon=$(document.createElement("img"));pie_wait_icon.src="images/UI/loading-big.gif";$(document.body).appendChild(pie_wait_icon);var a=pie_wait_icon.getSize();pie_wait_icon.setStyles({left:(pie_info.x-(a.size.x/2))+"px",top:(pie_info.y-(a.size.y/2))+"px",position:"absolute"})}function piemenu_init(b,e,c,a,d){pie_info={x:b,y:e};gloryIO("?a=interface.dropdown&guid="+c+"&pos="+a+"&parent="+d,false,true);piemenu_wait()}var hoveredItem=false;$(window).addEvent("load",function(a){initWaiter();initDisplayBuffer();$("datapane").addEvent("contextmenu",function(c){c=new Event(c);var b=getScrollPosition();if(hoveredItem!=false){piemenu_dispose();piemenu_init(c.event.clientX+b.x,c.event.clientY+b.y,hoveredItem.g,"MAP")}else{piemenu_dispose()}c.stop()});$("datapane").addEvent("mousedown",function(b){piemenu_dispose()});$("datapane").addEvent("click",function(f){f=new Event(f);var h=$("datapane").getLeft();var g=$("datapane").getTop();var c=getScrollPosition();var b=Math.ceil((f.event.clientX-h+c.x)/32)+glob_x_base-1;var d=Math.ceil((f.event.clientY-g+c.y)/32)+glob_y_base-1;if(rectinfo.url==""){hitTestRegion(b,d)}else{gloryIO(rectinfo.url+"&x="+b+"&y="+d);if(rectinfo.clickdispose){rectinfo.url="";$("grid_rect").setStyles({display:"none"})}}piemenu_dispose()});gloryIO("?a=map.grid.get");feeder()});$(window).addEvent("focus",function(a){return;feeder_enabled=true;if(feeder_timer==0){feeder_timer=setTimeout(feeder,1000)}});$(window).addEvent("blur",function(a){return;feeder_enabled=false;feeder_timer=0});$(window).onerror=function(b){if($defined(showStatus)){try{showStatus('<font color="red">Script Error!</font><br /><small>'+b+"</small>",1000)}catch(a){window.alert(b)}}else{window.alert(b)}};$(document).addEvent("keydown",function(b){b=new Event(b);if(b.code==27){var a=$("grid_rect");if(a){if(a.getStyle("display")!="none"){a.setStyles({display:"none"});rectinfo.url=""}}piemenu_dispose();b.stop()}else{if(b.control){b.stop();if(b.key=="b"){gloryIO("?a=interface.inventory")}}}});$(document).addEvent("mouseup",function(a){piemenu_dispose()});$(document).addEvent("contextmenu",function(a){var a=new Event(a);piemenu_dispose();a.stop()});$(document).addEvent("mousemove",function(h){h=new Event(h);var l=$("datapane").getLeft();var k=$("datapane").getTop();var d=getScrollPosition();var c=Math.ceil((h.event.clientX-l+d.x)/32)-1;var i=Math.ceil((h.event.clientY-k+d.y)/32)-1;var j=c+glob_x_base;var f=i+glob_y_base;var b="";var g="";if($defined(nav_grid[j])){if($defined(nav_grid[j][f-1])){b=nav_grid[j][f-1];g=nav_grid.dic[b]}}if(g.d){hoveredItem=g}else{hoveredItem=false}if(!pie_visible){hitTestRegion(j,f);if(hoveredItem){$("prompt").setHTML("X: "+j+", Y: "+f+" With Zero at: "+glob_x_base+","+glob_y_base+", Overlay: "+b+" Dic:"+g.d.name);hoverShow(g.d.name,h.event.clientX+d.x,h.event.clientY+d.y)}else{$("prompt").setHTML("X: "+j+", Y: "+f+" With Zero at: "+glob_x_base+","+glob_y_base);hoverShow(false)}var a=$("grid_rect");if(a){if(a.getStyle("display")!="none"){a.setStyles({left:(c-rectinfo.bx)*32,top:(i-rectinfo.by)*32,width:rectinfo.w*32,height:rectinfo.h*32,display:""})}}}});function display(a){gloryIO("index.php?"+a)};